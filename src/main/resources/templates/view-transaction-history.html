<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transaction History</title>
<link rel="stylesheet" href="../css/header-sidebar.css">
<link rel="stylesheet" href="../css/account-dashboard.css">
<script src="../js/sidebar.js" defer></script>
<script src="../js/sort-tables.js" defer></script>
</head>
<body>
	<!-- 	Top Bar -->
	<!-- 	keep this for now -->
	<div class="top-bar">
		<span class="menu-btn" onclick="toggleMenu()">&#9776;</span> <img
			src="../img/CreditOCubeLogo.png" alt="Logo" class="center-logo">
	</div>

	<div class="side-menu menu-active" id="sideMenu">
		<div class="user-greeting">
			<p>MY TRANSACTION HISTORY</p>

		</div>
		<a href="customer-dashboard">Back to Main Dashboard</a><a
			href="creditcard-dashboard">View Credit Card Dashboard</a>
		<form th:action="@{/logout}" method="post">
			<div class="buttons">
				<button type="submit" class="login-button">Logout</button>
			</div>
		</form>
	</div>
	<!-- 	keep this for now -->


	<div class="content-area main-content">
		<div class="actions-container">
			<!-- Create Debit Account Button -->
			<form th:action="@{/go-to-create-debit-account}" method="get">
				<input type="submit" class="debit-action-buttons"
					value="Create Debit Account">
			</form>
			<form th:action="@{/account-dashboard}" method="get">
				<input type="submit" class="debit-action-buttons"
					value="View all Debit Accounts">
			</form>
			<form th:action="@{/view-transaction-history}" method="get">
				<input type="submit" class="debit-action-buttons"
					value="View transaction history">
			</form>
			<form th:action="@{/deposit-withdraw}" method="get">
				<input type="submit" class="debit-action-buttons"
					value="Deposit / Withdraw">
			</form>
			<form th:action="@{/transfer-to-account-number}" method="get">
				<input type="submit" class="debit-action-buttons"
					value="Transfer Money">
			</form>
		</div>
		<div class="account-selection">
			<form th:action="find-by-month-debit" method="POST">
				<label for="selectedAccountId">Choose an account:</label> <select
					name="selectedAccountId" id="selectedAccountId">
					<option th:each="account : ${session.accounts}"
						th:value="${account.accountId}" th:text="${account.accountName}"></option>
				</select>
				  <select id="month-filter" name="month">  
				  <option value="month">Select Month</option>
			        <option value="1">January</option>
			        <option value="2">February</option>
			        <option value="3">March</option>
			        <option value="4">April</option>
			        <option value="5">May</option>
			        <option value="6">June</option>
			        <option value="7">July</option>
			        <option value="8">August</option>
			        <option value="9">September</option>
			        <option value="10">October</option>
			        <option value="11">November</option>
			        <option value="12">December</option>
			        <option value="13"> View All</option>
			    </select>
			    <button type="submit" class="debit-action-buttons">Filter</button>
			</form>
			<div class="account-selection" th:if="${monthSearched}">
			    <form th:action="@{/find-by-date-debit}" method="POST">
			        Start Date:
			        <input type="date" name="dateFrom" placeholder="Date From">
			        End Date:
			        <input type="date" name="dateTo" placeholder="Date To">
			        <button type="submit">Search</button>
			    </form>
			</div>
			

		</div>
		<!-- Conditional content for transaction history -->
		<div class="table-scrollable"
			th:if="${session.selectedAccount != null}">
			<table id="myTable">
				<thead>
					<tr>
						<th>Transaction Date <span class="sort-icon"
							onclick="sortTable(0)">▼</span></th>
						<th>From <span class="sort-icon" onclick="sortTable(1)">▼</span></th>
						<th>To <span class="sort-icon" onclick="sortTable(2)">▼</span></th>
						<th>Transaction Type <span class="sort-icon"
							onclick="sortTable(3)">▼</span></th>
						<th>Amount <span class="sort-icon" onclick="sortTable(4)">▼</span></th>
					</tr>
				</thead>
				<tbody>
					<!-- Loop over transactions -->
					<tr th:each="transaction : ${session.accountTransactions}">
						<td
							th:text="${#dates.format(transaction.debitAccountTransactionDate, 'dd-MMM-yyyy HH:mm')}"></td>
						<!-- <td th:text="${transaction.fromAccount?.accountNumber ?: '---'}"></td> -->
						<td th:text="${transaction.getFormattedFromAccountNumber()}"></td>
						<td th:text="${transaction.getFormattedToAccountNumber()}"></td>
						<td th:text="${transaction.debitAccountTransactionType}"></td>
						<td
							th:text="${transaction.debitAccountTransactionAmount} + ' SGD'"></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<!-- JavaScript for Sidebar Toggle -->
	<script src="../js/sidebar.js"></script>
</body>
</html>